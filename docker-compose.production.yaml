version: "3"
services:
  indexer:
    image: maximumstock2/indexer:latest
    restart: "always"
    env_file:
      - configuration/environments/.env.production
    environment:
      ENV: "production"
      METRICS_PORT: 4000
      RUST_LOG: "info,ureq=warn"
      # disable sinks
      DATABASE_URL:
      RABBITMQ_SINK_ENABLED: "false"
      RABBITMQ_URL: "amqp://poe:poe@rabbitmq"
      RABBITMQ_PRODUCER_ROUTING_KEY: "stash-record-stream"

  reverse-proxy:
    ports:
      - 0.0.0.0:80:80
    env_file:
      - configuration/environments/.env.production

  db:
    env_file:
      - configuration/environments/.env.production

  rabbitmq:
    env_file:
      - configuration/environments/.env.production

  prometheus:
    env_file:
      - configuration/environments/.env.production

  grafana:
    env_file:
      - configuration/environments/.env.production